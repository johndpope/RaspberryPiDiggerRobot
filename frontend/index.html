<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>DiggerRobot</title>
        <meta name="author" content="Ralph Hughes">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="lib/jquery.mousewheel.min.js"></script>
        <script src="lib/gauge.min.js"></script>
        
        <link rel="stylesheet" href="css/styles.css">
        <script src="js/frontend.js"></script>
        <script src="js/mobile_events.js"></script>
        <script src="js/mouse_events.js"></script>
        <script src="js/keyboard_events.js"></script>
        
        <script>
            $( document ).ready(function() {      
                var isMobile = window.matchMedia("only screen and (max-width: 760px)");
                if (isMobile.matches) {
                    addTouchEvents();
                    addTiltEvents();
                } else {
                    addMouseHandlers();
                    addKeyboardHandlers();
                }
                
                var intervalId = setInterval(function(){
                    // UI update loop
                    var valueForGauge1 = Math.abs(Math.round(100 * (tractionMotor/255)));
                    tractionMotorGauge.value = valueForGauge1;
                    
                    var valueForGauge2 = Math.round(100 * ((steeringServo-500) / 500));
                    steeringServoGauge.value = valueForGauge2;
                }, 150);

             });
        </script>
    </head>
    <body>
        <form>
            <input id="connect" type="button" value="Connect" />&nbsp;
            <input id="text" />&nbsp;<input id="send" type="button" value="Send" /><br />
        </form>
        <span id="message"></span>

        <div id="container" oncontextmenu="return false;">
            <img src="images/test_pattern.png" alt="Video Feed" id="mainImg"/>
        </div>
        <span id="debug"></span>
        <hr/>
        <h5>Unfinished status overlays</h5>
        <canvas id="gauge1"></canvas>
        <canvas id="gauge2"></canvas>
        <br/>
        Latency: <span id="ping">--</span> ms<br/>
        CPU Temp: <span id="temp">--</span>&#176;C<br/>
        Current Drain: <span id="current">--</span> mA<br/>
        <hr/>
        <h5>Help \ Controls</h5>
        <ul>
            <li><img src="images/icons8-keyboard-40.png" alt="W,A,S,D"/> W,A,S,D - Controls forwards, backwards and steering of the robot</li>
            <li><img src="images/icons8-cursor-40.png" alt="Move mouse"/> - Controls direction camera on robot faces</li>
            <li><img src="images/icons8-left-click-40.png" alt="Left click"/> - Move digger arm up</li>
            <li><img src="images/icons8-mouse-right-click-40.png" alt="Right click"/> - Move digger arm down</li>
            <li><img src="images/icons8-mouse-scrolling-40.png" alt="Scrollwheel"/> - Tilt bucket with scrollwheel</li>
            <li><img src="images/icons8-esc-40.png" alt="Esc or spacebar"/>[Esc] or [Spacebar] - Stop</li>
        </ul>
        
        <script>
            // Configure the JS gauges
            var tractionMotorGauge = new RadialGauge({
                renderTo: 'gauge1',
                width: 100,
                height: 100,
                minValue: '0',
                maxValue: '100',
                value: '0',
                borders: false,
                valueBox: false,
                majorTicks: ['0','10','20','30','40','50','60','70','80','90','100'],
                animation: false
            });
            tractionMotorGauge.draw();
            
            var steeringServoGauge = new RadialGauge({
                renderTo: 'gauge2',
                width: 150,
                height: 150,
                minValue: '-100',
                maxValue: '100',
                value: '0',
                borders: false,
                valueBox: false,
                majorTicks: ['-100','-80','-60','-40','-20','0','20','40','60','80','100'],
                startAngle: 90,
                ticksAngle: 180,
                colorPlate: "#fff",
                borderShadowWidth: 0,
                borders: false,
                needleType: "arrow",
                needleWidth: 2,
                needleCircleSize: 7,
                needleCircleOuter: true,
                needleCircleInner: false,
                animation: false
            });
            steeringServoGauge.draw();
            
        </script>
    </body>
</html>
